  FROM node:20-alpine AS builder
  WORKDIR /app
  RUN corepack enable && corepack prepare yarn@4.1.0 --activate
  COPY package.json yarn.lock .yarnrc.yml ./
  RUN yarn install --immutable

  # ============================================================================
  # ğŸ”¥ í™˜ê²½ë³€ìˆ˜ ìë™ ì£¼ì… ì„¤ì • 
  # ============================================================================
  # Jenkinsfileì—ì„œ Secretì˜ ëª¨ë“  NEXT_PUBLIC_ ë³€ìˆ˜ë¥¼ --build-argë¡œ ì „ë‹¬í•©ë‹ˆë‹¤.
  # ìƒˆ í™˜ê²½ë³€ìˆ˜ ì¶”ê°€ ì‹œ: ì´ ì„¹ì…˜ì— ARGì™€ ENVë¥¼ ì¶”ê°€í•˜ì„¸ìš”!
  # ============================================================================

  ARG NEXT_PUBLIC_API_URL
  ARG NEXT_PUBLIC_GOOGLE_CLIENT_ID
  ARG NEXT_PUBLIC_GOOGLE_CLIENT_SOURCE
  ARG NEXT_PUBLIC_POLA_API_BASE_URL
  ARG NEXT_PUBLIC_SHARE_KEY

  # ARGë¥¼ ENVë¡œ export (Next.js ë¹Œë“œ ì‹œ í•„ìš”)
  ENV NEXT_PUBLIC_API_URL=$NEXT_PUBLIC_API_URL
  ENV NEXT_PUBLIC_GOOGLE_CLIENT_ID=$NEXT_PUBLIC_GOOGLE_CLIENT_ID
  ENV NEXT_PUBLIC_GOOGLE_CLIENT_SOURCE=$NEXT_PUBLIC_GOOGLE_CLIENT_SOURCE
  ENV NEXT_PUBLIC_POLA_API_BASE_URL=$NEXT_PUBLIC_POLA_API_BASE_URL
  ENV NEXT_PUBLIC_SHARE_KEY=$NEXT_PUBLIC_SHARE_KEY

  # ============================================================================

  COPY . .

  # í™˜ê²½ë³€ìˆ˜ í™•ì¸ (ë””ë²„ê¹…ìš©)
  RUN echo "=== Environment Variables ==="
  RUN echo "NEXT_PUBLIC_API_URL: ${NEXT_PUBLIC_API_URL}"
  RUN echo "NEXT_PUBLIC_GOOGLE_CLIENT_ID: ${NEXT_PUBLIC_GOOGLE_CLIENT_ID}"
  RUN echo "NEXT_PUBLIC_GOOGLE_CLIENT_SOURCE: ${NEXT_PUBLIC_GOOGLE_CLIENT_SOURCE}"
  RUN echo "NEXT_PUBLIC_POLA_API_BASE_URL: ${NEXT_PUBLIC_POLA_API_BASE_URL}"
  RUN echo "============================"

  RUN yarn build

  FROM node:20-alpine
  WORKDIR /app
  ENV NODE_ENV=production
  RUN corepack enable && corepack prepare yarn@4.1.0 --activate
  COPY --from=builder /app/package.json /app/yarn.lock /app/.yarnrc.yml ./
  COPY --from=builder /app/.next ./.next
  COPY --from=builder /app/public ./public
  RUN yarn install --frozen-lockfile
  EXPOSE 3000
  CMD ["yarn", "start"]